---
title: 在 Kubernetes 上部署 Langflow 开发环境
slug: /deployment-kubernetes-dev
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

[Langflow 集成开发环境 (IDE)](https://github.com/langflow-ai/langflow-helm-charts/tree/main/charts/langflow-ide) Helm chart 旨在为开发人员提供完整的环境来创建、测试和调试他们的流程。它包括 API 和 UI。

### 前提条件

- 一个 [Kubernetes](https://kubernetes.io/docs/setup/) 集群
- [kubectl](https://kubernetes.io/docs/tasks/tools/#kubectl)
- [Helm](https://helm.sh/docs/intro/install/)

### 准备 Kubernetes 集群

此示例使用 [Minikube](https://minikube.sigs.k8s.io/docs/start/)，但您可以使用任何 Kubernetes 集群。

1. 在 Minikube 上创建 Kubernetes 集群。

	```shell
	minikube start
	```

2. 设置 `kubectl` 使用 Minikube。

	```shell
	kubectl config use-context minikube
	```

### 安装 Langflow IDE Helm chart

1. 将仓库添加到 Helm 并更新它。

	```shell
	helm repo add langflow https://langflow-ai.github.io/langflow-helm-charts
	helm repo update
	```

2. 在 `langflow` 命名空间中使用默认选项安装 Langflow。

	```shell
	helm install langflow-ide langflow/langflow-ide -n langflow --create-namespace
	```

3. 检查 Pod 的状态。

	```shell
	kubectl get pods -n langflow
	```

### 访问 Langflow IDE

启用本地端口转发以从本地机器访问 Langflow。

1. 使 Langflow API 在端口 7860 上从本地机器可访问：
```shell
kubectl port-forward -n langflow svc/langflow-service-backend 7860:7860
```

2. 使 Langflow UI 在端口 8080 上从本地机器可访问：
```shell
kubectl port-forward -n langflow svc/langflow-service 8080:8080
```

现在您可以执行以下操作：
- 在 `http://localhost:7860` 访问 Langflow API。
- 在 `http://localhost:8080` 访问 Langflow UI。

### 配置 Langflow 版本

Langflow 默认使用 `latest` 版本部署。

要指定不同的 Langflow 版本，请在 [values.yaml](https://github.com/langflow-ai/langflow-helm-charts/blob/main/charts/langflow-ide/values.yaml) 文件中设置 `langflow.backend.image.tag` 和 `langflow.frontend.image.tag` 值。

```yaml
langflow:
  backend:
    image:
      tag: "1.0.0a59"
  frontend:
    image:
      tag: "1.0.0a59"
```

### 配置外部存储

默认情况下，chart 部署存储在本地持久磁盘中的 SQLite 数据库。如果您想使用外部 PostgreSQL 数据库，可以通过两种方式进行配置：

* 使用内置的 PostgreSQL chart：
```yaml
postgresql:
  enabled: true
  auth:
    username: "langflow"
    password: "langflow-postgres"
    database: "langflow-db"
```

* 使用外部数据库：
```yaml
postgresql:
  enabled: false

langflow:
  backend:
    externalDatabase:
      enabled: true
      driver:
        value: "postgresql"
      port:
        value: "5432"
      user:
        value: "langflow"
      password:
        valueFrom:
          secretKeyRef:
            key: "password"
            name: "your-secret-name"
      database:
        value: "langflow-db"
    sqlite:
      enabled: false
```

### 配置扩展

扩展前端和后端服务的副本数量和资源：

```yaml
langflow:
  backend:
    replicaCount: 1
    resources:
      requests:
        cpu: 0.5
        memory: 1Gi
      # limits:
      #   cpu: 0.5
      #   memory: 1Gi

  frontend:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        cpu: 0.3
        memory: 512Mi
      # limits:
      #   cpu: 0.3
      #   memory: 512Mi
```

:::note
如果您的流程依赖于共享状态，如内置聊天记忆，您需要在水平扩展时设置共享数据库。
:::

有关 `langflow-ide` 部署的更多示例，请参阅 [Langflow Helm Charts 仓库](https://github.com/langflow-ai/langflow-helm-charts/tree/main/examples/langflow-ide)。
